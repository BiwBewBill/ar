<!DOCTYPE html>
<html>
<head>
    <title>AR Weather Custom Marker</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <script>
        // Logic การควบคุมสภาพอากาศ (เหมือนเดิม)
        AFRAME.registerComponent('weather-control', {
            init: function () {
                window.changeWeather = function(type) {
                    var sun = document.querySelector('#sun');
                    var rain = document.querySelector('#rain');
                    var night = document.querySelector('#night');
                    var light = document.querySelector('#dir-light');
                    var env = document.querySelector('#env-base');

                    // Reset
                    sun.setAttribute('visible', 'false');
                    rain.setAttribute('visible', 'false');
                    night.setAttribute('visible', 'false');

                    // Set Type
                    if (type === 'sunny') {
                        sun.setAttribute('visible', 'true');
                        light.setAttribute('light', 'intensity: 1.2; color: #FFF');
                        env.setAttribute('color', '#4CC3D9');
                    } else if (type === 'rainy') {
                        rain.setAttribute('visible', 'true');
                        light.setAttribute('light', 'intensity: 0.6; color: #889');
                        env.setAttribute('color', '#5D6D7E');
                    } else if (type === 'night') {
                        night.setAttribute('visible', 'true');
                        light.setAttribute('light', 'intensity: 0.3; color: #555');
                        env.setAttribute('color', '#17202A');
                    }
                }
            }
        });

        // Click Handler
        AFRAME.registerComponent('click-handler', {
            init: function () {
                this.el.addEventListener('click', function (evt) {
                    window.changeWeather(this.getAttribute('data-weather'));
                });
                this.el.addEventListener('touchstart', function (evt) {
                    window.changeWeather(this.getAttribute('data-weather'));
                });
            }
        });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">
    
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; patternRatio: 0.50" 
             renderer="logarithmicDepthBuffer: true;"
             vr-mode-ui="enabled: false">
        
        <a-entity id="dir-light" light="type: directional; intensity: 1;" position="1 2 1"></a-entity>
        <a-light type="ambient" intensity="0.5"></a-light>

        <a-marker type="pattern" url="marker.patt" weather-control>
            
            <a-cylinder id="env-base" position="0 0 0" radius="1.5" height="0.1" color="#4CC3D9" opacity="0.9"></a-cylinder>
            <a-cone position="-0.8 0.5 -0.5" color="#2ECC71" radius-bottom="0.3" height="0.8"></a-cone>
            <a-box position="0.5 0.3 0" color="#F1C40F" scale="0.6 0.6 0.6"></a-box>

            <a-entity id="sun" visible="true" position="0 2 -1">
                <a-sphere color="yellow" radius="0.5"></a-sphere>
                <a-ring color="orange" radius-inner="0.6" radius-outer="0.7"></a-ring>
            </a-entity>

            <a-entity id="rain" visible="false" position="0 1.5 0">
                <a-sphere color="grey" radius="0.4" position="0 0.5 0"></a-sphere>
                <a-entity>
                    <a-cylinder color="blue" height="0.1" radius="0.02" position="-0.2 -0.2 0"></a-cylinder>
                    <a-cylinder color="blue" height="0.1" radius="0.02" position="0.2 -0.4 0"></a-cylinder>
                </a-entity>
            </a-entity>

            <a-entity id="night" visible="false" position="0 2 -1">
                <a-sphere color="#DDD" radius="0.4"></a-sphere>
            </a-entity>

            <a-entity position="0 0.5 1.2" rotation="-45 0 0">
                <a-box position="-0.8 0 0" scale="0.5 0.2 0.1" color="orange" class="clickable" data-weather="sunny" click-handler></a-box>
                <a-text value="SUN" position="-0.8 0 0.06" align="center" scale="0.5 0.5 0.5"></a-text>

                <a-box position="0 0 0" scale="0.5 0.2 0.1" color="blue" class="clickable" data-weather="rainy" click-handler></a-box>
                <a-text value="RAIN" position="0 0 0.06" align="center" scale="0.5 0.5 0.5"></a-text>

                <a-box position="0.8 0 0" scale="0.5 0.2 0.1" color="black" class="clickable" data-weather="night" click-handler></a-box>
                <a-text value="NIGHT" position="0.8 0 0.06" align="center" color="white" scale="0.5 0.5 0.5"></a-text>
            </a-entity>

        </a-marker>

        <a-entity camera>
            <a-entity cursor="fuse: false; rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
        </a-entity>

    </a-scene>
</body>
</html>
